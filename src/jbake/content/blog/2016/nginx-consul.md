title=Docker+Consul+Nginx, используем Service Discovery для конфигурирования Reverse Proxy
date=2016-04-06
type=post
tags=blog
status=draft
~~~~~~

# Зачем это вообще нужно?

Изведав Service Discovery в действии на примере Solr Cloud, я возжелал использовать этот подход как можно шире.
Что может быть лучше, чем возможность просто добавить еще один сервер, а он уже сам заберёт настройки из хранилища,
узнает об остальных запущенных серверах и т.д.

Solr использует для Service Discovery Zookeeper, что и понятно: Zookeeper, как и Solr являются проектами инкубатора
Apache. Но, если уж начистоту, то Zookeeper достаточно сложное для использования хранилище: Service Discovery, например,
для него приходится реализовывать самостоятельно. Существует специальный проект Curator, который реализует основные
шаблоны работы с Zookeeper.

Поисследовав немного существующие проекты, я пришел к выводу что самым удачным для моих задач является [http://consul.io](Consul).
Наиболее интересным фишками Consul является:
 * Возможность запуска consul-агентов на каждой машине вашей инфраструктуры. Это позволяет вашим сервисам всегда обращаться
 к Consul по заранее известному адресу, соответственно, не нужно конфигурировать адрес Consul (в случае использования
 Zookeeper необходимо указывать все хосты, на которых расположен ваш Ensemble Zookeeper'а).
 * Consul позволяет легко регистрировать даже те сервисы, которые не умеют с ним интегрироваться. Для этого consul-agent
 может быть сконфигурирован соответствующим образом, что при старте он будет регистрировать заданные сервисы, а также
 HealthCheck для них. (С Zookeeper для этого придется использовать некое приложение, которое будет держать эфемерный
 узел в соответствующем узле дерева Zookeeper).
 * Consul позволяет использовать health сheck, при этом он может следить за нагрузкой на IO, объемом потребляемой памяти,
нагрузкой на центральный процессор, опрашивать определенный HTTP endpoint и многое другое.
 * Для работы с Consul используется человекочитаемое REST API.
